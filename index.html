
<!DOCTYPE html> 
<html>
<head>
	<title>MyBooks</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css">
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script>
</head>
<body>
	<!-- logon-page -->
	<div data-role="page" data-theme="b" id="logon-page">
		<div data-role="header">
			<h1>LogOn - MyBooks</h1>
		</div>
		<div data-role="main" class="ui-content">
			<form id="logon-form" action="index.html">
				<div class="fieldcontain">
					<label for="password">Your password</label>
					<input type="hidden" name="f" value="logon"/>
					<input type="password" name="password" placeholder="Write your password here!" required />
					<input type="submit" name="logonSubmit" value="Ok, show mybooks!"/>
				</div>
			</form>
		</div>
		<div data-role="footer" data-position="fixed" class="ui-bar">
			<div class="fieldcontain">
				<input type="button" name="getsourcecode" class="getsourcecode" value="Get source code"/>
				<script>
				//on 'Get source code' button-clicked
				$(function(){
					$('.getsourcecode').on('click', function(e){
						window.location.href = 'https://github.com/voidcode/';
					});
				});
				</script>
			</div>
		</div>
	</div>
	<!-- booklist-page -->
	<div data-role="page" data-theme="b" id="booklist-page">
	    <div data-role="header">
	   		<a href="#logon-page" data-icon="back" data-role="button" class="exit-booklist-page">EXIT</a>
	        <h1>MyBooks</h1>
	        <a href="#upload-book">UPLOAD</a>
	    </div>
	    <div data-role="main" class="ui-content">
            <ul data-role="listview" data-autodividers="true" data-inset="true"  data-filter="true" class="booklist" data-filter-placeholder="Find a book"></ul>
	    </div>
	    <script>
	    $(function(){
	    	$('.exit-booklist-page').on('click', function(event){
				//rm all item from 'booklist'
				$('.booklist').empty();
	    	});
	    	$('.booklist').empty();
	    	//on logon-page form submit
	    	$('#logon-form').submit(function(event){
		    	$.ajax({
		    		type: 'GET',
		    		async: true,
		    		dataType: 'json',
		    		url: 'api.php',
		    		data: $(this).serializeArray(),
		    	}).done(function(data){
		    		//gets books from api-php base on login 'err', if true then 
		    		//fill listview-page with 'books'
		    		if(!data.err){
				    	//show the #booklist-page
		    			window.location.href = 'index.html#booklist-page'
			    		$.ajax({
			    			type: 'GET',
			    			async: true,
				            url:'api.php',
				            data: {f: 'getBooks'},
				            dataType: 'json'
				        }).done(function(books){
				        	//rm all item from 'booklist'
				        	$('.booklist').empty();
				        	//apped books to listview
				            $.each(books, function(index, value){
				                $('.booklist').append('<li>'+
				                    '<a target="_blank" href="books/'+value+'">'+
				                    	'<img src="covers/'+value+'.jpg"/>'+
				                    	value+ //<-- this is path to one-book-item
				                    '</a>'+
				                '</li>');
				            });
				            $('.booklist').listview('refresh');
				        });
		    		}
		    		else {
		    			alert('This is not the password!');
		    		}
		    	});
	    		event.preventDefault();
	    	});
	    });
	    </script>
	    <div data-role="footer" data-position="fixed"></div>
	</div>
</body>
</html>